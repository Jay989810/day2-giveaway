<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARES BLACK BOX TERMINAL</title>
    <style>
        :root {
            --bg-color: #050505;
            --term-color: #0f0;
            --error-color: #f00;
            --glow-color: rgba(0, 255, 0, 0.5);
            --scanline-color: rgba(0, 0, 0, 0.5);
            --font-stack: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--term-color);
            font-family: var(--font-stack);
            overflow: hidden;
            font-size: 16px;
        }

        /* CRT Overlay Effects */
        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        .crt-flicker {
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 0.97;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.98;
            }
        }

        /* Terminal Container */
        #terminal {
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow-y: auto;
            text-shadow: 0 0 5px var(--glow-color);
        }

        /* Scrollbar hiding */
        #terminal::-webkit-scrollbar {
            display: none;
        }

        #terminal {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .line {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .input-line {
            display: flex;
            align-items: center;
        }

        .prompt {
            margin-right: 10px;
            color: var(--term-color);
        }

        .cursor {
            width: 10px;
            height: 1.2em;
            background-color: var(--term-color);
            animation: blink 1s step-end infinite;
            display: inline-block;
            vertical-align: text-bottom;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Hidden Input */
        #cmd-input {
            position: absolute;
            opacity: 0;
            top: -1000px;
        }

        /* Text Colors */
        .text-green {
            color: var(--term-color);
        }

        .text-red {
            color: var(--error-color);
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }

        .text-yellow {
            color: #ff0;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }

        /* Victory Button */
        .claim-btn {
            display: inline-block;
            margin-top: 20px;
            border: 2px solid var(--term-color);
            color: var(--term-color);
            padding: 15px 30px;
            text-decoration: none;
            font-family: var(--font-stack);
            font-weight: bold;
            text-transform: uppercase;
            background: transparent;
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-color);
            transition: all 0.3s ease;
        }

        .claim-btn:hover {
            background-color: var(--term-color);
            color: #000;
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }

            #terminal {
                padding: 10px;
            }
        }
    </style>
</head>

<body>

    <div class="crt-overlay"></div>
    <div id="terminal" class="crt-flicker">
        <div id="output"></div>
        <div class="input-line" id="input-line" style="display:none;">
            <span class="prompt">NARES_MEMBER@TERM:~$</span>
            <span id="user-typed"></span><span class="cursor"></span>
        </div>
    </div>

    <input type="text" id="cmd-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
        autofocus>

    <script>
        // --- CONSTANTS & CONFIG ---
        const MAX_ATTEMPTS = 3;
        const STORAGE_KEY = 'nares_blackbox_attempts_v2';

        const STAGES = [
            { id: 1, text: "INITIATING... INPUT THE FULL MEANING OF 'NRC' (THE NATIONAL OPERATOR).", ans: ["NIGERIAN RAILWAY CORPORATION"] },
            { id: 2, text: "WHAT COMPONENT ARE THE STEEL RAILS LAID UPON? (STARTS WITH S).", ans: ["SLEEPERS", "SLEEPER"] },
            { id: 3, text: "A TRAIN TRAVELS 100KM IN 1 HOUR. WHAT IS ITS SPEED IN KM/H?", ans: ["100"] },
            { id: 4, text: "WHAT COLOR SIGNAL INDICATES 'DANGER' OR 'STOP'?", ans: ["RED"] },
            { id: 5, text: "ENTER THE STANDARD GAUGE WIDTH IN MM.", ans: ["1435"] },
            { id: 6, text: "WHO IS THE PERSON THAT DRIVES THE LOCOMOTIVE?", ans: ["DRIVER", "LOCO PILOT", "PILOT"] },
            { id: 7, text: "WHAT DEVICE IS USED TO CHANGE THE TRAIN FROM ONE TRACK TO ANOTHER?", ans: ["SWITCH", "POINT", "POINTS"] },
            { id: 8, text: "TO STOP THE TRAIN, YOU APPLY THE...?", ans: ["BRAKES", "BRAKE"] },
            { id: 9, text: "THE MAJOR STANDARD GAUGE LINE CONNECTS LAGOS TO WHICH CITY?", ans: ["IBADAN"] },
            { id: 10, text: "WHAT IS THE METAL PART THE TRAIN WHEELS ROLL ON CALLED?", ans: ["RAIL", "TRACK", "STEEL RAIL"] },
            { id: 11, text: "A PLACE WHERE TRAINS LOAD AND UNLOAD PASSENGERS IS CALLED A...?", ans: ["STATION", "TERMINAL"] },
            { id: 12, text: "ENTER YOUR ASSOCIATION ACRONYM.", ans: ["NARES"] }
        ];

        // --- STATE ---
        let currentStageIndex = 0;
        let isTyping = false;
        let isGameOver = false;
        let isVictory = false;
        let isTransitioning = false;
        let audioCtx;

        // --- DOM ELEMENTS ---
        const terminalEl = document.getElementById('terminal');
        const outputEl = document.getElementById('output');
        const inputLineEl = document.getElementById('input-line');
        const userTypedEl = document.getElementById('user-typed');
        const cmdInput = document.getElementById('cmd-input');

        // --- AUDIO SYSTEM ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playTone(freq, type, duration) {
            if (!audioCtx) initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playBeep() {
            playTone(1200, 'sine', 0.08);
        }

        function playError() {
            playTone(100, 'sawtooth', 0.4);
        }

        // --- SECURITY SYSTEM ---
        function getAttempts() {
            return parseInt(localStorage.getItem(STORAGE_KEY) || '0');
        }

        function incrementAttempts() {
            let attempts = getAttempts();
            attempts++;
            localStorage.setItem(STORAGE_KEY, attempts);
            return attempts;
        }

        function checkLockout() {
            if (getAttempts() >= MAX_ATTEMPTS) {
                showRedScreen("SECURITY LOCKOUT. MAX ATTEMPTS EXCEEDED. YOU ARE BANNED.");
                return true;
            }
            return false;
        }

        function handleCheating() {
            if (isGameOver || isVictory) return;

            incrementAttempts();
            playError();
            showRedScreen("CONNECTION LOST. FOCUS CHANGE DETECTED.");
        }

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (currentStageIndex >= 0 && !isGameOver && !isVictory) {
                    handleCheating();
                }
            }
        });

        // --- UI DRAWING & TYPEWRITER ---
        function clearScreen() {
            outputEl.innerHTML = '';
            userTypedEl.textContent = '';
            inputLineEl.style.display = 'none';
        }

        function appendLine(text, className = 'text-green') {
            const div = document.createElement('div');
            div.className = `line ${className}`;
            outputEl.appendChild(div);
            terminalEl.scrollTop = terminalEl.scrollHeight;
            return div;
        }

        function typeText(text, className = 'text-green', speed = 25) {
            return new Promise((resolve) => {
                isTyping = true;
                const div = appendLine('', className);
                let i = 0;

                function typeChar() {
                    if (i < text.length) {
                        div.textContent += text.charAt(i);
                        i++;
                        terminalEl.scrollTop = terminalEl.scrollHeight;
                        setTimeout(typeChar, speed);
                    } else {
                        isTyping = false;
                        resolve();
                    }
                }
                typeChar();
            });
        }

        function showRedScreen(msg) {
            isGameOver = true;
            document.body.style.backgroundColor = '#100';
            document.body.style.color = '#f00';
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                el.style.color = '#f00';
                el.style.borderColor = '#f00';
            });

            terminalEl.innerHTML = '';
            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.top = '50%';
            container.style.left = '50%';
            container.style.transform = 'translate(-50%, -50%)';
            container.style.textAlign = 'center';
            container.style.width = '90%';

            container.innerHTML = `
                <h1 style="color:red; text-shadow:0 0 10px red; margin-bottom: 20px;">${msg}</h1>
                <p style="font-size: 1.2em;">SYSTEM ACCESS PERMANENTLY REVOKED.</p>
                <p style="margin-top:20px; font-size: 0.8em; opacity: 0.7;">STRIKE ${getAttempts()}/${MAX_ATTEMPTS}</p>
            `;
            document.body.appendChild(container);

            cmdInput.disabled = true;
        }

        // --- GAME LOGIC ---
        async function startGame() {
            if (checkLockout()) return;

            appendLine("Click or press any key to initialize system...", "text-green");

            const startHandler = () => {
                document.removeEventListener('click', startHandler);
                document.removeEventListener('keydown', startHandler);
                initAudio();
                clearScreen();
                loadStage(0);
            };

            document.addEventListener('click', startHandler);
            document.addEventListener('keydown', startHandler);
        }

        async function loadStage(index) {
            currentStageIndex = index;
            if (index >= STAGES.length) {
                handleVictory();
                return;
            }

            const stage = STAGES[index];
            inputLineEl.style.display = 'none';

            await typeText(`STAGE ${stage.id}: ${stage.text}`);

            userTypedEl.textContent = '';
            cmdInput.value = '';
            inputLineEl.style.display = 'flex';
            cmdInput.focus();
            isTransitioning = false;
        }

        async function handleVictory() {
            isVictory = true;
            clearScreen();
            playBeep();

            await typeText("ACCESS GRANTED. SYSTEM UNLOCKED.", "text-green");

            const randomHex = Math.floor(Math.random() * 16777215).toString(16).toUpperCase().padStart(6, '0');
            const hash = `USD-NARES-${randomHex}`;

            await typeText(`GENERATING REWARD HASH... ${hash}`, "text-yellow");
            await typeText("...", "text-green");

            const claimUrl = `https://wa.me/2347089799407?text=${encodeURIComponent(`I cracked the Black Box! My Key: ${hash}. Claiming the reward.`)}`;

            const btn = document.createElement('a');
            btn.href = claimUrl;
            btn.target = "_blank";
            btn.className = "claim-btn";
            btn.innerText = "CLAIM DOLLAR REWARD";

            outputEl.appendChild(btn);
            terminalEl.scrollTop = terminalEl.scrollHeight;
        }

        async function handleInput(inputVal) {
            if (isTyping || isTransitioning || isGameOver) return;

            const normalized = inputVal.trim().toUpperCase().replace(/\s+/g, ' ');
            const stage = STAGES[currentStageIndex];

            inputLineEl.style.display = 'none';
            appendLine(`NARES_MEMBER@TERM:~$ ${normalized}`, "text-green");

            isTransitioning = true;

            const isCorrect = stage.ans.includes(normalized);

            if (isCorrect) {
                playBeep();
                setTimeout(() => {
                    clearScreen();
                    loadStage(currentStageIndex + 1);
                }, 400);
            } else {
                playError();
                await typeText("ACCESS DENIED.", "text-red");

                incrementAttempts();

                setTimeout(() => {
                    // Strict Mode: Session End
                    if (getAttempts() >= MAX_ATTEMPTS) {
                        checkLockout();
                    } else {
                        // Not banned yet, but session is over
                        appendLine("SESSION TERMINATED DUE TO ERROR.", "text-red");
                        appendLine("PRESS REFRESH TO TRY AGAIN.", "text-yellow");
                        cmdInput.disabled = true;
                    }
                }, 800);
            }
        }

        // --- INPUT EVENT LISTENERS ---

        document.addEventListener('click', () => {
            if (!isGameOver && !cmdInput.disabled) cmdInput.focus();
        });

        cmdInput.addEventListener('input', (e) => {
            userTypedEl.textContent = cmdInput.value.toUpperCase();
        });

        cmdInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleInput(cmdInput.value);
            }
        });

        // Initialize
        startGame();

    </script>
</body>

</html>
