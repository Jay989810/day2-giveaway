<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARES SPEED CHALLENGE</title>
    <style>
        :root {
            --bg-color: #050505;
            --term-color: #0f0;
            --error-color: #f00;
            --warn-color: #fa0;
            --glow-color: rgba(0, 255, 0, 0.5);
            --font-stack: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--term-color);
            font-family: var(--font-stack);
            overflow: hidden;
            font-size: 16px;
        }

        /* CRT Overlay Effects */
        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        .crt-flicker {
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 0.97;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.98;
            }
        }

        /* Layout */
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header / Stats */
        #hud {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--term-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 0 0 5px var(--glow-color);
        }

        /* Terminal Area */
        #terminal {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            text-shadow: 0 0 3px var(--glow-color);
        }

        #terminal::-webkit-scrollbar {
            display: none;
        }

        .line {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
        }

        /* Input Area */
        .input-line {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .prompt {
            margin-right: 10px;
            color: var(--term-color);
        }

        .cursor {
            width: 10px;
            height: 1.2em;
            background-color: var(--term-color);
            animation: blink 1s step-end infinite;
            display: inline-block;
            vertical-align: text-bottom;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Timer Bar */
        #timer-container {
            width: 100%;
            height: 4px;
            background: #222;
            margin-top: 10px;
            display: none;
        }

        #timer-bar {
            width: 100%;
            height: 100%;
            background: var(--term-color);
            transition: width 0.1s linear;
        }

        /* Hidden Input */
        #cmd-input {
            position: absolute;
            opacity: 0;
            top: -1000px;
        }

        /* Colors */
        .text-green {
            color: var(--term-color);
        }

        .text-red {
            color: var(--error-color);
        }

        .text-warn {
            color: var(--warn-color);
        }

        /* Victory Button */
        .claim-btn {
            display: inline-block;
            margin-top: 20px;
            border: 2px solid var(--term-color);
            color: var(--term-color);
            padding: 15px 30px;
            text-decoration: none;
            font-weight: bold;
            background: transparent;
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-color);
            text-align: center;
        }

        .claim-btn:hover {
            background-color: var(--term-color);
            color: #000;
        }

        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }

            #game-container {
                padding: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="crt-overlay"></div>

    <div id="game-container" class="crt-flicker">
        <div id="hud">
            <span id="score-display">SCORE: 00/30</span>
            <span id="time-display">READY</span>
        </div>

        <div id="terminal">
            <div id="output"></div>
            <div class="input-line" id="input-line" style="display:none;">
                <span class="prompt">ANSWER ></span>
                <span id="user-typed"></span><span class="cursor"></span>
            </div>
        </div>

        <div id="timer-container">
            <div id="timer-bar"></div>
        </div>
    </div>

    <input type="text" id="cmd-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
        autofocus>

    <script>
        // --- DATA ---
        const STAGES = [
            { id: 1, text: "NRC STANDS FOR?", ans: ["NIGERIAN RAILWAY CORPORATION"] },
            { id: 2, text: "WHAT ARE RAILS LAID ON? (STARTS WITH S)", ans: ["SLEEPERS", "SLEEPER"] },
            { id: 3, text: "SPEED = DISTANCE DIVIDED BY?", ans: ["TIME"] },
            { id: 4, text: "COLOR OF STOP SIGNAL?", ans: ["RED"] },
            { id: 5, text: "STANDARD GAUGE WIDTH (MM)?", ans: ["1435"] },
            { id: 6, text: "PERSON WHO DRIVES THE TRAIN?", ans: ["DRIVER", "LOCO PILOT", "PILOT"] },
            { id: 7, text: "DEVICE TO SWITCH TRACKS?", ans: ["SWITCH", "POINT", "POINTS"] },
            { id: 8, text: "OPPOSITE OF ACCELERATION?", ans: ["DECELERATION", "BRAKING"] },
            { id: 9, text: "LAGOS-IBADAN LINE IS WHAT CAGE?", ans: ["STANDARD", "STANDARD GAUGE"] },
            { id: 10, text: "WHEELS ROLL ON WHAT?", ans: ["RAIL", "TRACKS", "RAILS", "STEEL RAILS"] },
            { id: 11, text: "PASSENGERS BOARD AT A?", ans: ["STATION", "TERMINAL"] },
            { id: 12, text: "NARES STANDS FOR NIGERIAN ASSOCIATION OF RAILWAY...?", ans: ["ENGINEERING STUDENTS"] },
            { id: 13, text: "FORCE = MASS X ?", ans: ["ACCELERATION"] },
            { id: 14, text: "UNIT OF ELECTRIC CURRENT?", ans: ["AMPERE", "AMP"] },
            { id: 15, text: "TRAIN THAT CARRIES GOODS?", ans: ["FREIGHT", "CARGO"] },
            { id: 16, text: "TRAINS RUN ON ROAD OR TRACK?", ans: ["TRACK", "TRACKS"] },
            { id: 17, text: "POWER SOURCE FOR ELECTRIC TRAINS?", ans: ["ELECTRICITY", "POWER", "CATENARY"] },
            { id: 18, text: "UNIT OF VOLTAGE?", ans: ["VOLT", "VOLTS"] },
            { id: 19, text: "LOCOMOTIVE PULLS THE...?", ans: ["TRAIN", "COACHES", "WAGONS"] },
            { id: 20, text: "GAP BETWEEN RAILS IS CALLED?", ans: ["GAUGE"] },
            { id: 21, text: "STRUCTURE CARRYING TRAIN OVER WATER?", ans: ["BRIDGE"] },
            { id: 22, text: "UNDERGROUND RAILWAY PASSAGE?", ans: ["TUNNEL"] },
            { id: 23, text: "TICKET INSPECTOR IS CALLED?", ans: ["CONDUCTOR", "TICKET CHECKER"] },
            { id: 24, text: "SYMBOL FOR IRON?", ans: ["FE"] },
            { id: 25, text: "3.14 IS APPROX VALUE OF?", ans: ["PI"] },
            { id: 26, text: "H2O IS COMMON NAME FOR?", ans: ["WATER"] },
            { id: 27, text: "BINARY FOR 2?", ans: ["10"] },
            { id: 28, text: "DOES A MAGLEV TOUCH THE TRACK? (YES/NO)", ans: ["NO"] },
            { id: 29, text: "APPROX GRAVITY VALUE (M/S^2)?", ans: ["9.8", "10", "9.81"] },
            { id: 30, text: "YOUR DEPARTMENT ACRONYM?", ans: ["NARES"] }
        ];

        const TIME_LIMIT = 15; // Seconds per question
        const PASS_SCORE = 24; // 80% of 30

        // --- STATE ---
        let currentStageIndex = 0;
        let score = 0;
        let timeLeft = 0;
        let timerInterval = null;
        let isTyping = false;
        let isGameOver = false;
        let audioCtx;

        // --- ELEMENTS ---
        const terminalEl = document.getElementById('terminal');
        const outputEl = document.getElementById('output');
        const inputLineEl = document.getElementById('input-line');
        const userTypedEl = document.getElementById('user-typed');
        const cmdInput = document.getElementById('cmd-input');
        const scoreEl = document.getElementById('score-display');
        const timeEl = document.getElementById('time-display');
        const timerBar = document.getElementById('timer-bar');
        const timerContainer = document.getElementById('timer-container');

        // --- AUDIO ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }
        function playTone(f, t, d) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = t; o.frequency.value = f;
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }
        function playCorrect() { playTone(800, 'sine', 0.1); }
        function playWrong() { playTone(150, 'sawtooth', 0.3); }

        // --- ENGINE ---
        function clearScreen() {
            outputEl.innerHTML = '';
            userTypedEl.textContent = '';
            inputLineEl.style.display = 'none';
        }

        function appendLine(text, className = 'text-green') {
            const d = document.createElement('div');
            d.className = `line ${className}`;
            d.textContent = text;
            outputEl.appendChild(d);
            terminalEl.scrollTop = terminalEl.scrollHeight;
            return d;
        }

        function updateHUD(time) {
            scoreEl.textContent = `SCORE: ${score}/${STAGES.length}`;
            if (time !== undefined) timeEl.textContent = `TIME: ${time.toFixed(1)}s`;
        }

        async function startGame() {
            // --- MAX ATTEMPTS LOGIC ---
            const ATTEMPT_KEY = 'nares_attempts_v3';
            const MAX_ATTEMPTS = 2; // 1 initial + 1 retry
            let attempts = parseInt(localStorage.getItem(ATTEMPT_KEY) || '0');

            if (attempts >= MAX_ATTEMPTS) {
                document.body.style.backgroundColor = '#200';
                appendLine("MAXIMUM ATTEMPTS REACHED.", "text-red");
                appendLine("SYSTEM LOCKED. YOU CANNOT PARTICIPATE AGAIN.", "text-red");
                return;
            }

            appendLine("NARES SPEED CHALLENGE SYSTEM V2.0", "text-green");
            appendLine("---------------------------------");
            appendLine(`ATTEMPT: ${attempts + 1}/${MAX_ATTEMPTS}`, "text-warn");
            appendLine("30 QUESTIONS. 15 SECONDS EACH.", "text-warn");
            appendLine("PASS MARK: 80% (24/30).", "text-warn");
            appendLine("CLICK ANYWHERE START.", "text-green");

            const start = () => {
                document.removeEventListener('click', start);
                document.removeEventListener('keydown', start);

                // Register attempt on start
                localStorage.setItem(ATTEMPT_KEY, attempts + 1);

                initAudio();
                clearScreen();
                loadStage(0);
            };
            document.addEventListener('click', start);
            document.addEventListener('keydown', start);
        }

        function startTimer() {
            timeLeft = TIME_LIMIT;
            timerContainer.style.display = 'block';
            updateHUD(timeLeft);

            clearInterval(timerInterval);
            const startTime = Date.now();

            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                timeLeft = Math.max(0, TIME_LIMIT - elapsed);
                updateHUD(timeLeft);

                // Visual Bar
                const pct = (timeLeft / TIME_LIMIT) * 100;
                timerBar.style.width = `${pct}%`;
                timerBar.style.backgroundColor = pct < 30 ? '#f00' : '#0f0';

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeOut();
                }
            }, 50);
        }

        function handleTimeOut() {
            playWrong();
            appendLine(`TIMEOUT! ANSWER WAS: ${STAGES[currentStageIndex].ans[0]}`, "text-red");
            nextStage();
        }

        function nextStage() {
            setTimeout(() => {
                loadStage(currentStageIndex + 1);
            }, 1000);
        }

        function loadStage(idx) {
            currentStageIndex = idx;
            clearInterval(timerInterval);
            timerContainer.style.display = 'none';

            if (idx >= STAGES.length) {
                endGame();
                return;
            }

            // Display
            clearScreen(); // One question at a time focus
            const stage = STAGES[idx];

            const qDiv = document.createElement('div');
            qDiv.className = 'line text-green';
            qDiv.style.fontSize = '1.2em';
            qDiv.style.marginBottom = '20px';
            qDiv.textContent = `Q${idx + 1}: ${stage.text}`;
            outputEl.appendChild(qDiv);

            userTypedEl.textContent = '';
            cmdInput.value = '';
            inputLineEl.style.display = 'flex';
            cmdInput.focus();
            cmdInput.disabled = false;

            startTimer();
        }

        function handleInput(val) {
            clearInterval(timerInterval);
            cmdInput.disabled = true; // Prevent double submit

            const normalized = val.trim().toUpperCase().replace(/\s+/g, ' ');
            const stage = STAGES[currentStageIndex];

            appendLine(`> ${normalized}`, "text-green");

            const isCorrect = stage.ans.includes(normalized);
            if (isCorrect) {
                playCorrect();
                appendLine("CORRECT", "text-green");
                score++;
            } else {
                playWrong();
                appendLine(`WRONG. ANSWER: ${stage.ans[0]}`, "text-red");
            }

            updateHUD();
            nextStage();
        }

        function endGame() {
            clearScreen();
            inputLineEl.style.display = 'none';
            timeEl.textContent = "FINISHED";

            const passed = score >= PASS_SCORE;
            const color = passed ? "text-green" : "text-red";

            appendLine(`FINAL SCORE: ${score}/30`, color);
            appendLine(`PERCENTAGE: ${Math.floor((score / 30) * 100)}%`, color);

            if (passed) {
                appendLine("CONGRATULATIONS! YOU PASSED.", "text-green");
                playCorrect();

                const randomHex = Math.floor(Math.random() * 16777215).toString(16).toUpperCase().padStart(6, '0');
                const hash = `NARES-WIN-${randomHex}`;

                appendLine(`REWARD HASH: ${hash}`, "text-warn");

                const claimUrl = `https://wa.me/2347089799407?text=${encodeURIComponent(`I beat the NARES Speed Challenge! Score: ${score}/30. Key: ${hash}`)}`;

                const btn = document.createElement('a');
                btn.href = claimUrl;
                btn.className = "claim-btn";
                btn.textContent = "CLAIM REWARD ON WHATSAPP";
                btn.target = "_blank";
                outputEl.appendChild(btn);
            } else {
                appendLine("YOU DID NOT REACH THE 80% THRESHOLD.", "text-red");
                appendLine("PLEASE TRY AGAIN.", "text-warn");

                const ATTEMPT_KEY = 'nares_attempts_v3';
                const MAX_ATTEMPTS = 2;
                let attempts = parseInt(localStorage.getItem(ATTEMPT_KEY) || '0');

                if (attempts < MAX_ATTEMPTS) {
                    appendLine(`ATTEMPTS REMAINING: ${MAX_ATTEMPTS - attempts}`, "text-warn");
                    const retryBtn = document.createElement('div');
                    retryBtn.className = "claim-btn";
                    retryBtn.textContent = "RETRY CHALLENGE";
                    retryBtn.onclick = () => location.reload();
                    outputEl.appendChild(retryBtn);
                } else {
                    appendLine("MAXIMUM ATTEMPTS EXCEEDED.", "text-red");
                    appendLine("SYSTEM ACCESS REVOKED.", "text-red");
                }
            }
        }

        // Logic
        cmdInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !cmdInput.disabled) {
                handleInput(cmdInput.value);
            }
        });

        cmdInput.addEventListener('input', () => {
            userTypedEl.textContent = cmdInput.value.toUpperCase();
        });

        document.addEventListener('click', () => {
            if (inputLineEl.style.display !== 'none') cmdInput.focus();
        });

        // Start
        startGame();

    </script>
</body>

</html>
